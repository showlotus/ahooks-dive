---
title: Components
description: Some builtin components
---

# [useSetState](https://ahooks.js.org/zh-CN/hooks/use-set-state)

## ğŸ“– ç”¨æ³•

ç”¨äºæ›´æ–°å¯¹è±¡çŠ¶æ€ï¼Œè‡ªåŠ¨åˆå¹¶å¯¹è±¡ã€‚

<ViewCode src="./use-set-state/use-set-state.tsx" />

## ğŸ“„ [æºç ](https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useSetState/index.ts)

{/* prettier-ignore */}
```ts [useSetState.ts]
import { useState } from 'react';
import useMemoizedFn from '../useMemoizedFn';
import { isFunction } from '../utils';

export type SetState<S extends Record<string, any>> = <K extends keyof S>(
  state: Pick<S, K> | null | ((prevState: Readonly<S>) => Pick<S, K> | S | null),
) => void;

const useSetState = <S extends Record<string, any>>(
  initialState: S | (() => S),
): [S, SetState<S>] => {
  const [state, setState] = useState<S>(initialState);

  const setMergeState = useMemoizedFn((patch) => {
    setState((prevState) => {
      const newState = isFunction(patch) ? patch(prevState) : patch;
      return newState ? { ...prevState, ...newState } : prevState;
    });
  });

  return [state, setMergeState];
};

export default useSetState;
```

## ğŸ” è§£è¯»

é‡ç‚¹å°±æ˜¯ `setMergeState` å‡½æ•°ã€‚

é¦–å…ˆä½¿ç”¨ `useMemoizedFn` ç¼“å­˜å‡½æ•°å¼•ç”¨ï¼Œé¿å…é‡å¤åˆ›å»ºå‡½æ•°ã€‚

:::tip
å…³äº `useMemoizedFn`ï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”æ–‡æ¡£ï¼š[useMemoizedFn](../../advanced/use-memoized-fn/)ã€‚
:::

{/* prettier-ignore */}
```ts
const useSetState = <S extends Record<string, any>>(
  initialState: S | (() => S),
): [S, SetState<S>] => {
  const [state, setState] = useState<S>(initialState);

  const setMergeState = useMemoizedFn((patch) => { // [!code focus:6]
    setState((prevState) => {
      const newState = isFunction(patch) ? patch(prevState) : patch;
      return newState ? { ...prevState, ...newState } : prevState;
    });
  });

  return [state, setMergeState];
};
```

å†…éƒ¨ç›´æ¥è°ƒç”¨ `setState` å‡½æ•°ï¼Œå¹¶ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚

{/* prettier-ignore */}
```ts
const useSetState = <S extends Record<string, any>>(
  initialState: S | (() => S),
): [S, SetState<S>] => {
  const [state, setState] = useState<S>(initialState);

  const setMergeState = useMemoizedFn((patch) => { 
    setState((prevState) => { // [!code focus:4]
      const newState = isFunction(patch) ? patch(prevState) : patch;
      return newState ? { ...prevState, ...newState } : prevState;
    });
  });

  return [state, setMergeState];
};
```

å¦‚æœ `patch` æ˜¯å‡½æ•°ï¼Œåˆ™è°ƒç”¨ `patch` å‡½æ•°ï¼Œå¹¶ä¼ å…¥ `prevState` å‚æ•°ï¼Œè¿”å›æ–°çš„çŠ¶æ€ã€‚å¦åˆ™ï¼Œç›´æ¥è¿”å› `patch`ã€‚

æœ€åï¼Œå¦‚æœ `newState` ä¸º `Truthy` å€¼ï¼Œåˆ™è¿”å›ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦åˆå¹¶åçš„æ–°å¯¹è±¡ã€‚å¦åˆ™è¿”å› `prevState`ã€‚

å†…éƒ¨ä¹Ÿæ²¡æœ‰å¯¹ `prevState` å’Œ `newState` è¿›è¡Œç±»å‹åˆ¤æ–­ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦åˆå¹¶ã€‚å¦‚æœå¾—åˆ°çš„æ˜¯é `object` ç±»å‹ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚è¿™ä¸ªéœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚
