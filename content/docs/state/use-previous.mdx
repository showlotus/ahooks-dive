---
title: Components
description: Some builtin components
---

# [usePrevious](https://ahooks.js.org/zh-CN/hooks/use-previous)

## ğŸ“– ç”¨æ³•

ä¿å­˜ä¸Šä¸€æ¬¡çŠ¶æ€çš„ Hookã€‚

<ViewCode src="./demo.tsx" />

## ğŸ“„ [æºç ](https://github.com/alibaba/hooks/blob/master/packages/hooks/src/usePrevious/index.ts)

::: code-group

{/* prettier-ignore */}
```ts [usePrevious.ts]
import { useRef } from 'react';

export type ShouldUpdateFunc<T> = (prev?: T, next?: T) => boolean;

const defaultShouldUpdate = <T>(a?: T, b?: T) => !Object.is(a, b);

function usePrevious<T>(
  state: T,
  shouldUpdate: ShouldUpdateFunc<T> = defaultShouldUpdate,
): T | undefined {
  const prevRef = useRef<T>(undefined);
  const curRef = useRef<T>(undefined);

  if (shouldUpdate(curRef.current, state)) {
    prevRef.current = curRef.current;
    curRef.current = state;
  }

  return prevRef.current;
}

export default usePrevious;
```

:::

## ğŸ” è§£è¯»

åœ¨å†…éƒ¨å®šä¹‰ä¸¤ä¸ª `ref` å¯¹è±¡ï¼Œåˆ†åˆ«ç”¨äºå­˜å‚¨ä¸Šä¸€æ¬¡çŠ¶æ€å’Œå½“å‰çŠ¶æ€ï¼Œå¹¶åœ¨æ¯æ¬¡çŠ¶æ€æ›´æ–°æ—¶ï¼Œåˆ¤æ–­å½“å‰çŠ¶æ€ä¸ä¸Šä¸€æ¬¡çŠ¶æ€æ˜¯å¦ä¸åŒï¼Œå¦‚æœä¸åŒï¼Œåˆ™æ›´æ–°ä¸Šä¸€æ¬¡çŠ¶æ€ã€‚

{/* prettier-ignore */}
```ts
function usePrevious<T>(
  state: T,
  shouldUpdate: ShouldUpdateFunc<T> = defaultShouldUpdate,
): T | undefined {
  // 1. å®šä¹‰ä¸¤ä¸ª ref å¯¹è±¡ï¼Œåˆ†åˆ«ç”¨äºå­˜å‚¨ä¸Šä¸€æ¬¡çŠ¶æ€å’Œå½“å‰çŠ¶æ€
  const prevRef = useRef<T>(undefined);
  const curRef = useRef<T>(undefined);

  // 2. å¦‚æœå½“å‰çŠ¶æ€ä¸ä¸Šä¸€æ¬¡çŠ¶æ€ä¸åŒ
  if (shouldUpdate(curRef.current, state)) {
    // 2.1. æ›´æ–°ä¸Šä¸€æ¬¡çŠ¶æ€
    prevRef.current = curRef.current;
    // 2.2. æ›´æ–°å½“å‰çŠ¶æ€
    curRef.current = state;
  }

  // 3. è¿”å›ä¸Šä¸€æ¬¡çŠ¶æ€
  return prevRef.current;
}
```
