---
title: Components
description: Some builtin components
---

# [useMemoizedFn](https://ahooks.js.org/zh-CN/hooks/use-memoized-fn)

## ğŸ“– ç”¨æ³•

æŒä¹…åŒ– `function` çš„å¼•ç”¨ï¼Œä¿è¯å‡½æ•°å¼•ç”¨ä¿æŒä¸å˜ï¼Œé¿å…é‡å¤åˆ›å»ºå‡½æ•°ã€‚

<ViewCode src="./use-memoized-fn/use-memoized-fn.tsx" />

## ğŸ“„ [æºç ](https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useMemoizedFn/index.ts)

::: code-group

{/* prettier-ignore */}
```ts [useMemoizedFn.ts]
import { useMemo, useRef } from 'react';
import { isFunction } from '../utils';
import isDev from '../utils/isDev';

type noop = (this: any, ...args: any[]) => any;

type PickFunction<T extends noop> = (
  this: ThisParameterType<T>,
  ...args: Parameters<T>
) => ReturnType<T>;

const useMemoizedFn = <T extends noop>(fn: T) => {
  if (isDev) {
    if (!isFunction(fn)) {
      console.error(`useMemoizedFn expected parameter is a function, got ${typeof fn}`);
    }
  }

  const fnRef = useRef<T>(fn);

  // why not write `fnRef.current = fn`?
  // https://github.com/alibaba/hooks/issues/728
  fnRef.current = useMemo<T>(() => fn, [fn]);

  const memoizedFn = useRef<PickFunction<T>>(undefined);

  if (!memoizedFn.current) {
    memoizedFn.current = function (this, ...args) {
      return fnRef.current.apply(this, args);
    };
  }

  return memoizedFn.current;
};

export default useMemoizedFn;
```

:::

## ğŸ” è§£è¯»

å…ˆæ˜¯ç¯å¢ƒåˆ¤æ–­ï¼Œå¼€å‘æ¨¡å¼ä¸‹ä¼ å…¥å‚æ•°çš„ç±»å‹ä¸ä¸º `Function` æ—¶ï¼Œè¾“å‡ºé”™è¯¯æ—¥å¿—ã€‚

{/* prettier-ignore */}
```tsx
const useMemoizedFn = <T extends noop>(fn: T) => {
  if (isDev) { // [!code focus:5]
    if (!isFunction(fn)) {
      console.error(`useMemoizedFn expected parameter is a function, got ${typeof fn}`);
    }
  }

  /* ... */
}
```

ç„¶åä½¿ç”¨ `useRef` å®šä¹‰äº†ä¸€ä¸ª `fnRef` å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨ä¼ å…¥çš„å‡½æ•°ã€‚å¹¶ä¸”å½“ä¼ å…¥çš„ `fn` å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ›´æ–° `fnRef` å¯¹è±¡çš„å€¼ã€‚

::: tip
å…³äºä¸ºä»€ä¹ˆä½¿ç”¨ `useMemo` åŒ…è£¹ï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº” issueï¼š[#728](https://github.com/alibaba/hooks/issues/728)
:::

{/* prettier-ignore */}
```tsx
const useMemoizedFn = <T extends noop>(fn: T) => {
  /* ... */

  const fnRef = useRef<T>(fn); // [!code focus:5]

  // why not write `fnRef.current = fn`?
  // https://github.com/alibaba/hooks/issues/728
  fnRef.current = useMemo<T>(() => fn, [fn]);
}
```

æ¥ç€ä½¿ç”¨ `useRef` å®šä¹‰äº†ä¸€ä¸ª `memoizedFn` å¯¹è±¡ï¼Œåˆå§‹å€¼ä¸º `undefined`ï¼Œç”¨æ¥è®°å½•æ–°å‡½æ•°ã€‚

é¦–æ¬¡æ‰§è¡Œæ—¶ï¼Œä¼šæ›´æ–° `memoizedFn` å¯¹è±¡çš„å€¼ï¼Œèµ‹å€¼ä¸€ä¸ªæ–°å‡½æ•°ï¼Œæ–°å‡½æ•°å†…éƒ¨ä¼šä¿®æ”¹ `this` æŒ‡å‘åç›´æ¥è°ƒç”¨ `fnRef` å¯¹è±¡çš„å€¼ï¼Œå¹¶è¿”å›å‡½æ•°çš„æ‰§è¡Œç»“æœã€‚

é¦–æ¬¡æ›´æ–° `memoizedFn` å¯¹è±¡çš„å€¼åï¼Œåç»­ä¾¿ä¸å†æ›´æ–°ï¼Œè¿™ä¹Ÿæ˜¯ `useMemoizedFn` ä¸ºä»€ä¹ˆèƒ½ä¿è¯å‡½æ•°å¼•ç”¨ä¿æŒä¸å˜çš„åŸå› ã€‚

æœ€åè¿”å› `memoizedFn` å¯¹è±¡ä¸­è®°å½•çš„è¿™ä¸ªæ–°å‡½æ•°ã€‚

{/* prettier-ignore */}
```tsx
const useMemoizedFn = <T extends noop>(fn: T) => {
  /* ... */

  const memoizedFn = useRef<PickFunction<T>>(undefined); // [!code focus:9]

  if (!memoizedFn.current) {
    memoizedFn.current = function (this, ...args) {
      return fnRef.current.apply(this, args);
    };
  }

  return memoizedFn.current;
}
```

ç»¼ä¸Šï¼Œç®€å•æ¥è¯´ï¼Œ`useMemoizedFn` å°±æ˜¯åœ¨å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªæ–°å‡½æ•°ï¼Œæ–°å‡½æ•°å†…éƒ¨æ‰§è¡Œä¼ å…¥çš„å‡½æ•° `fn`ï¼Œå°† `fn` çš„æ‰§è¡Œç»“æœä½œä¸ºæ–°å‡½æ•°çš„è¿”å›å€¼ï¼Œæœ€åè¿”å›è¿™ä¸ªæ–°å‡½æ•°ï¼Œæ¥ä¿è¯å‡½æ•°çš„å¼•ç”¨ä¸€ç›´ä¸å˜ã€‚é€šè¿‡ `useRef` å’Œ `useMemo` æ¥ä¿è¯æ–°å‡½æ•°å†…éƒ¨æ‰§è¡Œçš„ `fn` å‡½æ•°å§‹ç»ˆæ˜¯æœ€æ–°çš„ `fn` ã€‚
