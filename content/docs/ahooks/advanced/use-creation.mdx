---
title: Components
description: Some builtin components
---

# [useCreation](https://ahooks.js.org/zh-CN/hooks/use-creation)

## ğŸ“– ç”¨æ³•

ç¼“å­˜è®¡ç®—é‡è¾ƒå¤§æˆ–åˆ›å»ºæˆæœ¬è¾ƒé«˜çš„æ•°æ®ã€‚

<ViewCode src="./use-creation/demo.tsx" />

## ğŸ“„ [æºç ](https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useCreation/index.ts)

::: code-group

{/* prettier-ignore */}
```ts [useCreation.ts]
import type { DependencyList } from 'react';
import { useRef } from 'react';
import depsAreSame from '../utils/depsAreSame';

const useCreation = <T>(factory: () => T, deps: DependencyList) => {
  const { current } = useRef({
    deps,
    obj: undefined as T,
    initialized: false,
  });
  if (current.initialized === false || !depsAreSame(current.deps, deps)) {
    current.deps = deps;
    current.obj = factory();
    current.initialized = true;
  }
  return current.obj;
};

export default useCreation;
```

{/* prettier-ignore */}
```ts [depsAreSame.ts]
import type { DependencyList } from 'react';

function depsAreSame(oldDeps: DependencyList, deps: DependencyList): boolean {
  if (oldDeps === deps) {
    return true;
  }
  for (let i = 0; i < oldDeps.length; i++) {
    if (!Object.is(oldDeps[i], deps[i])) {
      return false;
    }
  }
  return true;
}

export default depsAreSame;
```

:::

## ğŸ” è§£è¯»

å…ˆçœ‹ `depsAreSame` å‡½æ•°ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªä¾èµ–æ•°ç»„æ˜¯å¦ç›¸åŒï¼Œå†…éƒ¨é‡‡ç”¨ `Object.is` è¿›è¡Œæ¯”è¾ƒã€‚

{/* prettier-ignore */}
```ts
function depsAreSame(oldDeps: DependencyList, deps: DependencyList): boolean {
  if (oldDeps === deps) {
    return true;
  }
  for (let i = 0; i < oldDeps.length; i++) {
    if (!Object.is(oldDeps[i], deps[i])) {
      return false;
    }
  }
  return true;
}
```

è€Œ `useCreation` å‡½æ•°åˆ™æ˜¯åœ¨å†…éƒ¨ä½¿ç”¨ `useRef` å®šä¹‰äº†ä¸€ä¸ª `ref` å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨ä¾èµ–æ•°ç»„å’Œè®¡ç®—ç»“æœã€‚

{/* prettier-ignore */}
```ts [useCreation.ts]
const useCreation = <T>(factory: () => T, deps: DependencyList) => {
  // 1. å®šä¹‰ä¸€ä¸ª ref å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨ä¾èµ–æ•°ç»„å’Œè®¡ç®—ç»“æœ
  const { current } = useRef({
    deps,
    obj: undefined as T,
    initialized: false,
  });
  // 2. å¦‚æœä¾èµ–æ•°ç»„æœªåˆå§‹åŒ–ï¼Œæˆ–è€…ä¾èµ–æ•°ç»„å‘ç”Ÿå˜åŒ–ï¼Œåˆ™æ›´æ–°ä¾èµ–æ•°ç»„å¹¶é‡æ–°è®¡ç®—ç»“æœ
  if (current.initialized === false || !depsAreSame(current.deps, deps)) {
    // 2.1. æ›´æ–°ä¾èµ–æ•°ç»„
    current.deps = deps;
    // 2.2. é‡æ–°è®¡ç®—ç»“æœ
    current.obj = factory();
    // 2.3. æ ‡è®°ä¸ºå·²åˆå§‹åŒ–
    current.initialized = true;
  }
  // 3. è¿”å›è®¡ç®—ç»“æœ
  return current.obj;
};
```
