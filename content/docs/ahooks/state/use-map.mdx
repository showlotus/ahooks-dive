---
title: Components
description: Some builtin components
---

# [useMap](https://ahooks.js.org/zh-CN/hooks/use-map)

## ğŸ“– ç”¨æ³•

ç®¡ç† `Map` ç±»å‹çŠ¶æ€ã€‚

<ViewCode src="./use-map/demo.tsx" />

## ğŸ“„ [æºç ](https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useMap/index.ts)

{/* prettier-ignore */}
```ts [useMap.ts]
import { useState } from 'react';
import useMemoizedFn from '../useMemoizedFn';

function useMap<K, T>(initialValue?: Iterable<readonly [K, T]>) {
  const getInitValue = () => new Map(initialValue);
  const [map, setMap] = useState<Map<K, T>>(getInitValue);

  const set = (key: K, entry: T) => {
    setMap((prev) => {
      const temp = new Map(prev);
      temp.set(key, entry);
      return temp;
    });
  };

  const setAll = (newMap: Iterable<readonly [K, T]>) => {
    setMap(new Map(newMap));
  };

  const remove = (key: K) => {
    setMap((prev) => {
      const temp = new Map(prev);
      temp.delete(key);
      return temp;
    });
  };

  const reset = () => setMap(getInitValue());

  const get = (key: K) => map.get(key);

  return [
    map,
    {
      set: useMemoizedFn(set),
      setAll: useMemoizedFn(setAll),
      remove: useMemoizedFn(remove),
      reset: useMemoizedFn(reset),
      get: useMemoizedFn(get),
    },
  ] as const;
}

export default useMap;
```

## ğŸ” è§£è¯»

::: tip
å…³äº `useMemoizedFn`ï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”æ–‡æ¡£ï¼š[useMemoizedFn](../../advanced/use-memoized-fn/)ã€‚
:::

æœ¬è´¨ä¸Š `useMap` è¿”å›çš„å°±æ˜¯ä¸€ä¸ªæ™®é€š `Map` ç±»å‹çš„æ•°æ®ï¼Œè€Œåœ¨æ›´æ–°æ—¶åˆ™ä¼ å…¥ä¸€ä¸ªæ–°çš„ `Map` å¯¹è±¡ï¼Œä»è€Œè§¦å‘é¡µé¢é‡æ–°æ¸²æŸ“ã€‚

{/* prettier-ignore */}
```ts
function useMap<K, V>(initialValue?: Iterable<[K, V]>) {
  // 1. å®šä¹‰ä¸€ä¸ªè·å–åˆå§‹å€¼çš„å‡½æ•°ï¼Œæ–¹ä¾¿åç»­ reset å‡½æ•°å†…éƒ¨è°ƒç”¨
  const getInitValue = () => new Map(initialValue);
  // 2. å®šä¹‰ä¸€ä¸ª `Map` ç±»å‹çš„çŠ¶æ€ï¼Œåˆå§‹å€¼ä¸º `getInitValue` å‡½æ•°çš„è¿”å›å€¼
  const [map, setMap] = useState<Map<K, T>>(getInitValue);

  // 3. å®šä¹‰ä¸€ä¸ªæ›´æ–° `Map` å†…æŸä¸ªé”®å€¼å¯¹çš„æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªé”®å’Œå€¼ï¼Œæ›´æ–°æ—¶è¿”å›ä¸€ä¸ªæ–°çš„ `Map` å¯¹è±¡
  const set = useMemoizedFn((key: K, entry: T) => {
    setMap((prev) => {
      const temp = new Map(prev);
      temp.set(key, entry);
      return temp;
    });
  });

  // 4. å®šä¹‰ä¸€ä¸ªå…¨é‡æ›´æ–° `Map` æ•°æ®çš„æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ª `Map` å¯¹è±¡ï¼Œå…¨é‡æ›´æ–°æ—¶ä¼ å…¥ä¸€ä¸ªæ–°çš„ `Map` å¯¹è±¡
  const setAll = (newMap: Iterable<readonly [K, T]>) => {
    setMap(new Map(newMap));
  };

  // 5. å®šä¹‰ä¸€ä¸ªåˆ é™¤ `Map` å†…æŸä¸ªé”®å€¼å¯¹çš„æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªé”®ï¼Œåˆ é™¤æ—¶è¿”å›ä¸€ä¸ªæ–°çš„ `Map` å¯¹è±¡
  const remove = useMemoizedFn((key: K) => {
    setMap((prev) => {
      const temp = new Map(prev);
      temp.delete(key);
      return temp;
    });
  };

  // 6. å®šä¹‰ä¸€ä¸ªé‡ç½® `Map` æ•°æ®çš„æ–¹æ³•ï¼Œé‡ç½®æ—¶ä¼ å…¥ `getInitValue` å‡½æ•°çš„è¿”å›å€¼
  const reset = () => setMap(getInitValue());

  // 7. å®šä¹‰ä¸€ä¸ªè·å– `Map` å†…æŸä¸ªé”®å€¼å¯¹çš„æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ªé”®ï¼Œè·å–æ—¶è¿”å› `Map` å¯¹è±¡ä¸­å¯¹åº”é”®çš„å€¼
  const get = (key: K) => map.get(key);

  // 8. è¿”å› `Map` å¯¹è±¡å’Œæ›´æ–° `Map` æ•°æ®çš„æ–¹æ³•
  return [
    map,
    {
      set: useMemoizedFn(set),
      setAll: useMemoizedFn(setAll),
      remove: useMemoizedFn(remove),
      reset: useMemoizedFn(reset),
      get: useMemoizedFn(get),
    },
  ] as const;
}
```
