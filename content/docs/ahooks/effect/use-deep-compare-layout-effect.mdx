---
title: useDeepCompareLayoutEffect
description: 用于深度比较依赖的 Layout Effect Hook
---

<LinkButton
  url="https://ahooks.js.org/zh-CN/hooks/use-deep-compare-layout-effect"
  text="ahooks 文档"
/>
<LinkButton
  url="https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useDeepCompareLayoutEffect/index.tsx"
  text="源码"
/>

## 用法

用法与 `useLayoutEffect` 一致，不同的是，会深度比较依赖。

<ViewCode src="./use-deep-compare-layout-effect/demo.tsx" />

## 源码

{/* prettier-ignore */}
```ts tab="useDeepCompareLayoutEffect.ts"
import { useLayoutEffect } from 'react';
import { createDeepCompareEffect } from '../createDeepCompareEffect';

export default createDeepCompareEffect(useLayoutEffect);
```

{/* prettier-ignore */}
```ts tab="createDeepCompareEffect.ts"
import { useRef } from 'react';
import type { DependencyList, useEffect, useLayoutEffect } from 'react';
import { depsEqual } from '../utils/depsEqual';

type EffectHookType = typeof useEffect | typeof useLayoutEffect;

type CreateUpdateEffect = (hook: EffectHookType) => EffectHookType;

export const createDeepCompareEffect: CreateUpdateEffect = (hook) => (effect, deps) => {
  const ref = useRef<DependencyList>(undefined);
  const signalRef = useRef<number>(0);
  if (deps === undefined || !depsEqual(deps, ref.current)) {
    signalRef.current += 1;
  }
  ref.current = deps;
  hook(effect, [signalRef.current]);
};
```

{/* prettier-ignore */}
```ts tab="depsEqual.ts"
import type { DependencyList } from 'react';
import isEqual from 'react-fast-compare';

export const depsEqual = (aDeps: DependencyList = [], bDeps: DependencyList = []) =>
  isEqual(aDeps, bDeps);
```

## 解读

关于 `createDeepCompareEffect` 的解读，可以查看对应文档：[useDeepCompareEffect](../../effect/use-deep-compare-effect/#解读)。
