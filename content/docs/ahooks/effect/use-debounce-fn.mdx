---
title: Components
description: Some builtin components
---

# [useDebounceFn](https://ahooks.js.org/zh-CN/hooks/use-debounce-fn#usedebouncefn)

## ğŸ“– ç”¨æ³•

ç”¨æ¥å¤„ç†é˜²æŠ–å‡½æ•°çš„ Hookã€‚

<ViewCode src="./use-debounce-fn/demo.tsx" />

## ğŸ“„ [æºç ](https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useDebounceFn/index.ts)

::: code-group

{/* prettier-ignore */}
```ts [useDebounceFn.ts]
import { debounce } from '../utils/lodash-polyfill';
import { useMemo } from 'react';
import type { DebounceOptions } from '../useDebounce/debounceOptions';
import useLatest from '../useLatest';
import useUnmount from '../useUnmount';
import { isFunction } from '../utils';
import isDev from '../utils/isDev';

type noop = (...args: any[]) => any;

function useDebounceFn<T extends noop>(fn: T, options?: DebounceOptions) {
  if (isDev) {
    if (!isFunction(fn)) {
      console.error(`useDebounceFn expected parameter is a function, got ${typeof fn}`);
    }
  }

  const fnRef = useLatest(fn);

  const wait = options?.wait ?? 1000;

  const debounced = useMemo(
    () =>
      debounce(
        (...args: Parameters<T>): ReturnType<T> => {
          return fnRef.current(...args);
        },
        wait,
        options,
      ),
    [],
  );

  useUnmount(() => {
    debounced.cancel();
  });

  return {
    run: debounced,
    cancel: debounced.cancel,
    flush: debounced.flush,
  };
}

export default useDebounceFn;
```

:::

## ğŸ” è§£è¯»

::: tip
å…³äº `useLatest`ã€`useUnmount`ï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”æ–‡æ¡£ï¼š[useLatest](../../advanced/use-latest/)ã€[useUnmount](../../life-cycle/use-unmount/)ã€‚
:::

{/* prettier-ignore */}
```ts
function useDebounceFn<T extends noop>(fn: T, options?: DebounceOptions) {
  // 1. é¦–å…ˆï¼Œä½¿ç”¨ useLatest æ¥è®°å½•å‡½æ•°çš„æœ€æ–°å€¼ã€‚
  const fnRef = useLatest(fn);

  // 2. ç„¶åï¼Œä½¿ç”¨ options ä¸­çš„ wait å±æ€§æ¥è®¾ç½®é˜²æŠ–æ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º 1000msã€‚
  const wait = options?.wait ?? 1000;

  // 3. æ¥ç€ï¼Œä½¿ç”¨ useMemo æ¥ç¼“å­˜é˜²æŠ–åçš„å‡½æ•°ã€‚é˜²æŠ–åçš„å‡½æ•°å†…éƒ¨ä¼šè°ƒç”¨ fnRef å¯¹è±¡çš„å€¼ï¼Œå¹¶è¿”å›å‡½æ•°çš„æ‰§è¡Œç»“æœã€‚
  const debounced = useMemo(
    () =>
      // ä½¿ç”¨ lodash çš„ debounce å‡½æ•°å®ç°é˜²æŠ–å‡½æ•°ï¼Œå‚æ•°é…ç½®ä¹Ÿå®Œå…¨ä¸ lodash çš„ debounce å‡½æ•°ä¸€è‡´ã€‚
      debounce(
        (...args: Parameters<T>): ReturnType<T> => {
          return fnRef.current(...args);
        },
        wait,
        options,
      ),
    [],
  );

  // 4. ç„¶åï¼Œä½¿ç”¨ useUnmount æ¥å¸è½½é˜²æŠ–åçš„å‡½æ•°ã€‚
  useUnmount(() => {
    debounced.cancel();
  });

  // 5. æœ€åï¼Œè¿”å›é˜²æŠ–åçš„å‡½æ•°ï¼ŒåŒ…æ‹¬ runã€cancelã€flush ä¸‰ä¸ªæ–¹æ³•ã€‚
  return {
    run: debounced,
    cancel: debounced.cancel,
    flush: debounced.flush,
  };
}
```

æœ¬è´¨ä¸Šå°±æ˜¯åˆ©ç”¨ `debounce` æ¥å»¶æ—¶æ›´æ–° `state` çš„å€¼ï¼Œå®Œå…¨å¯ä»¥åˆ©ç”¨ `setTimeout` æ¥å®ç°ä¸€ä¸ªç®€æ˜“çš„ç‰ˆæœ¬ã€‚

<ViewCode src="./use-debounce-fn/demo2.tsx" />
