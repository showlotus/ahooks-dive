---
title: Components
description: Some builtin components
---

{/* # [useTheme](https://ahooks.js.org/zh-CN/hooks/use-theme) */}

## ğŸ“– ç”¨æ³•

è·å–å¹¶è®¾ç½®å½“å‰ä¸»é¢˜ï¼Œå¹¶å°†ä¸»é¢˜å­˜å‚¨åœ¨ `localStorage` ä¸­ã€‚

<ViewCode src="./use-theme/use-theme.tsx" />

## ğŸ“„ [æºç ](https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useTheme/index.ts)

::: code-group

{/* prettier-ignore */}
```ts [useTheme.ts]
import { useEffect, useState } from 'react';
import useMemoizedFn from '../useMemoizedFn';
import isBrowser from '../utils/isBrowser';

export enum ThemeMode {
  LIGHT = 'light',
  DARK = 'dark',
  SYSTEM = 'system',
}

export type ThemeModeType = `${ThemeMode}`;

export type ThemeType = 'light' | 'dark';

const useCurrentTheme = () => {
  const matchMedia = isBrowser ? window.matchMedia('(prefers-color-scheme: dark)') : undefined;
  const [theme, setTheme] = useState<ThemeType>(() => {
    if (isBrowser) {
      return matchMedia?.matches ? ThemeMode.DARK : ThemeMode.LIGHT;
    } else {
      return ThemeMode.LIGHT;
    }
  });

  useEffect(() => {
    const onThemeChange: MediaQueryList['onchange'] = (event) => {
      if (event.matches) {
        setTheme(ThemeMode.DARK);
      } else {
        setTheme(ThemeMode.LIGHT);
      }
    };

    matchMedia?.addEventListener('change', onThemeChange);

    return () => {
      matchMedia?.removeEventListener('change', onThemeChange);
    };
  }, []);

  return theme;
};

type Options = {
  localStorageKey?: string;
};

export default function useTheme(options: Options = {}) {
  const { localStorageKey } = options;

  const [themeMode, setThemeMode] = useState<ThemeModeType>(() => {
    const preferredThemeMode =
      localStorageKey?.length && (localStorage.getItem(localStorageKey) as ThemeModeType | null);

    return preferredThemeMode || ThemeMode.SYSTEM;
  });

  const setThemeModeWithLocalStorage = (mode: ThemeModeType) => {
    setThemeMode(mode);

    if (localStorageKey?.length) {
      localStorage.setItem(localStorageKey, mode);
    }
  };

  const currentTheme = useCurrentTheme();
  const theme = themeMode === ThemeMode.SYSTEM ? currentTheme : themeMode;

  return {
    theme,
    themeMode,
    setThemeMode: useMemoizedFn(setThemeModeWithLocalStorage),
  };
}
```

:::

## ğŸ” è§£è¯»

å…ˆçœ‹ `useCurrentTheme` çš„å®ç°ï¼Œç”¨æ¥è·å–å½“å‰çš„ä¸»é¢˜ `light` æˆ– `dark`ã€‚

åˆ›å»ºä¸€ä¸ª `matchMedia` å¯¹è±¡ï¼Œç”¨æ¥ç›‘å¬ç³»ç»Ÿä¸»é¢˜çš„å˜åŒ–ã€‚å¹¶ç”¨ä¸€ä¸ª `state` è®°å½•å½“å‰çš„ä¸»é¢˜ `light` æˆ– `dark`ã€‚

{/* prettier-ignore */}
```ts
const useCurrentTheme = () => {
  const matchMedia = isBrowser ? window.matchMedia('(prefers-color-scheme: dark)') : undefined; // [!code focus:8]
  const [theme, setTheme] = useState<ThemeType>(() => {
    if (isBrowser) {
      return matchMedia?.matches ? ThemeMode.DARK : ThemeMode.LIGHT;
    } else {
      return ThemeMode.LIGHT;
    }
  });

  /* ... */
};
```

ç„¶ååœ¨ `useEffect` ä¸­ç›‘å¬ç³»ç»Ÿä¸»é¢˜çš„å˜åŒ–ï¼Œå¹¶æ›´æ–° `theme`ã€‚æœ€åè¿”å› `theme`ã€‚

{/* prettier-ignore */}
```ts
const useCurrentTheme = () => {
  /* ... */

  useEffect(() => { // [!code focus:17]
    const onThemeChange: MediaQueryList['onchange'] = (event) => {
      if (event.matches) {
        setTheme(ThemeMode.DARK);
      } else {
        setTheme(ThemeMode.LIGHT);
      }
    };

    matchMedia?.addEventListener('change', onThemeChange);

    return () => {
      matchMedia?.removeEventListener('change', onThemeChange);
    };
  }, []);

  return theme;
};
```

æ¥ç€çœ‹ `useTheme` çš„å®ç°ã€‚

ä»å…¥å‚ä¸­è·å– `localStorageKey`ã€‚

å¦‚æœ `localStorageKey` å­˜åœ¨ï¼Œåˆ™ä» `localStorage` ä¸­è·å–ä¸»é¢˜æ¨¡å¼ã€‚å¦åˆ™ä½¿ç”¨é»˜è®¤å€¼ `ThemeMode.SYSTEM`ã€‚

è¿™é‡Œçš„ `themeMode` æ˜¯ä¸»é¢˜æ¨¡å¼ï¼Œå¯é€‰å€¼æœ‰ï¼š`light`ã€`dark`ã€`system`ã€‚

{/* prettier-ignore */}
```ts
export default function useTheme(options: Options = {}) {
  const { localStorageKey } = options; // [!code focus:8]

  const [themeMode, setThemeMode] = useState<ThemeModeType>(() => {
    const preferredThemeMode =
      localStorageKey?.length && (localStorage.getItem(localStorageKey) as ThemeModeType | null);

    return preferredThemeMode || ThemeMode.SYSTEM;
  });

  /* ... */
}
```

ç„¶åæ˜¯å®šä¹‰ `setThemeModeWithLocalStorage` å‡½æ•°ï¼Œç”¨æ¥æ›´æ–° `themeMode`ï¼Œå¹¶å°†å€¼å­˜å‚¨åˆ° `localStorage` ä¸­ã€‚

{/* prettier-ignore */}
```ts
export default function useTheme(options: Options = {}) {
  /* ... */

  const setThemeModeWithLocalStorage = (mode: ThemeModeType) => { // [!code focus:7]
    setThemeMode(mode);

    if (localStorageKey?.length) {
      localStorage.setItem(localStorageKey, mode);
    }
  };

  /* ... */
}
```

æœ€åï¼Œå…ˆæ˜¯è°ƒç”¨ `useCurrentTheme` è·å–å½“å‰ä¸»é¢˜ `currentTheme`ã€‚

å¦‚æœ `themeMode` ä¸º `system`ï¼Œåˆ™ä½¿ç”¨ `currentTheme` ä½œä¸ºå½“å‰ä¸»é¢˜ã€‚å¦åˆ™ä½¿ç”¨ `themeMode` ä½œä¸ºå½“å‰ä¸»é¢˜ã€‚

æœ€åè¿”å› `theme`ã€`themeMode` å’Œ `setThemeMode` å‡½æ•°ã€‚

:::tip
å…³äº `useMemoizedFn`ï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”æ–‡æ¡£ï¼š[useMemoizedFn](../../advanced/use-memoized-fn/)ï¼Œç”¨æ¥ç¼“å­˜å‡½æ•°å¼•ç”¨ï¼Œé¿å…é‡å¤åˆ›å»ºå‡½æ•°ã€‚
:::

{/* prettier-ignore */}
```ts
export default function useTheme(options: Options = {}) {
  /* ... */

  const currentTheme = useCurrentTheme(); // [!code focus:8]
  const theme = themeMode === ThemeMode.SYSTEM ? currentTheme : themeMode;

  return {
    theme,
    themeMode,
    setThemeMode: useMemoizedFn(setThemeModeWithLocalStorage),
  };
}
```
