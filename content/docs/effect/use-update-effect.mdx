---
title: Components
description: Some builtin components
---

# [useUpdateEffect](https://ahooks.js.org/zh-CN/hooks/use-update-effect#useupdateeffect)

## ğŸ“– ç”¨æ³•

ç”¨æ³•ç­‰åŒäº `useEffect`ï¼Œä½†ä¸åŒçš„æ˜¯ï¼Œä¼šå¿½ç•¥é¦–æ¬¡æ‰§è¡Œï¼Œåªåœ¨ä¾èµ–æ›´æ–°æ—¶æ‰§è¡Œã€‚

<ViewCode src="./use-update-effect/demo.tsx" />

## ğŸ“„ [æºç ](https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useUpdateEffect/index.ts)

::: code-group

{/* prettier-ignore */}
```ts [useUpdateEffect.ts]
import { useEffect } from 'react';
import { createUpdateEffect } from '../createUpdateEffect';

export default createUpdateEffect(useEffect);
```

{/* prettier-ignore */}
```ts [createUpdateEffect.ts]
import { useRef } from 'react';
import type { useEffect, useLayoutEffect } from 'react';

type EffectHookType = typeof useEffect | typeof useLayoutEffect;

export const createUpdateEffect: (hook: EffectHookType) => EffectHookType =
  (hook) => (effect, deps) => {
    const isMounted = useRef(false);

    // for react-refresh
    hook(() => {
      return () => {
        isMounted.current = false;
      };
    }, []);

    hook(() => {
      if (!isMounted.current) {
        isMounted.current = true;
      } else {
        return effect();
      }
    }, deps);
  };

export default createUpdateEffect;
```

:::

## ğŸ” è§£è¯»

é¦–å…ˆï¼Œè°ƒç”¨ `createUpdateEffect` å‡½æ•°ï¼Œä¼ å…¥ `useEffect` å‡½æ•°ã€‚`createUpdateEffect` å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°å‡½æ•°ã€‚è¿™æ ·å°è£…çš„ç›®çš„æ˜¯ä¸ºäº†æ”¯æŒ `useLayoutEffect` çš„ç”¨æ³•ã€‚ahooks ä¸­æœ‰å¾ˆå¤šç±»ä¼¼çš„è¿™ç§å°è£…ï¼Œå› ä¸ºéœ€è¦åŒæ—¶æ”¯æŒ `useEffect` å’Œ `useLayoutEffect` çš„ç”¨æ³•ã€‚

ç›´æ¥æŠŠæºç ä¸­çš„å‚æ•° `hook` æ›¿æ¢æˆ `useEffect`ï¼Œå†æ¥çœ‹çœ‹å®é™…çš„ä»£ç ï¼š

```ts
export const useUpdateEffect = (effect, deps) => {
  // 1. ä½¿ç”¨ useRef å®šä¹‰ä¸€ä¸ª ref å¯¹è±¡ï¼Œç”¨äºè®°å½•ç»„ä»¶æ˜¯å¦å·²ç»æŒ‚è½½
  const isMounted = useRef(false)

  // 2. ä½¿ç”¨ useEffect ç›‘å¬ç»„ä»¶çš„å¸è½½ï¼Œåœ¨ç»„ä»¶å¸è½½æ—¶ï¼Œå°† isMounted çš„å€¼è®¾ç½®ä¸º false
  useEffect(() => {
    return () => {
      isMounted.current = false
    }
  }, [])

  // 3. ä½¿ç”¨ useEffect ç›‘å¬ä¾èµ–çš„æ›´æ–°
  //    å› ä¸º useEffect ä¼šåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œä½†æ˜¯ç”±äº isMounted çš„åˆå§‹å€¼ä¸º falseï¼Œæ‰€ä»¥ä¼šè·³è¿‡è¿™æ¬¡ effect çš„æ‰§è¡Œ
  //    åç»­ä¾èµ–æ›´æ–°æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œ effect
  useEffect(() => {
    if (!isMounted.current) {
      isMounted.current = true
    } else {
      return effect()
    }
  }, deps)
}
```
