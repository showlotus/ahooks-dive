---
title: Components
description: Some builtin components
---

# [useThrottleFn](https://ahooks.js.org/zh-CN/hooks/use-throttle-fn#usethrottlefn)

## ğŸ“– ç”¨æ³•

ç”¨æ¥å¤„ç†èŠ‚æµå‡½æ•°çš„ Hookã€‚

<ViewCode src="./use-throttle-fn/demo.tsx" />

## ğŸ“„ [æºç ](https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useThrottleFn/index.ts)

::: code-group

{/* prettier-ignore */}
```ts [useThrottleFn.ts]
import throttle from 'lodash/throttle';
import { useMemo } from 'react';
import useLatest from '../useLatest';
import type { ThrottleOptions } from '../useThrottle/throttleOptions';
import useUnmount from '../useUnmount';
import { isFunction } from '../utils';
import isDev from '../utils/isDev';

type noop = (...args: any[]) => any;

function useThrottleFn<T extends noop>(fn: T, options?: ThrottleOptions) {
  if (isDev) {
    if (!isFunction(fn)) {
      console.error(`useThrottleFn expected parameter is a function, got ${typeof fn}`);
    }
  }

  const fnRef = useLatest(fn);

  const wait = options?.wait ?? 1000;

  const throttled = useMemo(
    () =>
      throttle(
        (...args: Parameters<T>): ReturnType<T> => {
          return fnRef.current(...args);
        },
        wait,
        options,
      ),
    [],
  );

  useUnmount(() => {
    throttled.cancel();
  });

  return {
    run: throttled,
    cancel: throttled.cancel,
    flush: throttled.flush,
  };
}

export default useThrottleFn;
```

:::

## ğŸ” è§£è¯»

::: tip
å…³äº `useLatest`ã€`useUnmount`ï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”æ–‡æ¡£ï¼š[useLatest](../../advanced/use-latest/)ã€[useUnmount](../../life-cycle/use-unmount/)ã€‚
:::

{/* prettier-ignore */}
```ts
function useThrottleFn<T extends noop>(fn: T, options?: ThrottleOptions) {
  // 1. é¦–å…ˆï¼Œä½¿ç”¨ useLatest æ¥è®°å½•å‡½æ•°çš„æœ€æ–°å€¼ã€‚
  const fnRef = useLatest(fn);

  // 2. ç„¶åï¼Œä½¿ç”¨ options ä¸­çš„ wait å±æ€§æ¥è®¾ç½®èŠ‚æµæ—¶é—´ï¼Œé»˜è®¤å€¼ä¸º 1000msã€‚
  const wait = options?.wait ?? 1000;

  // 3. æ¥ç€ï¼Œä½¿ç”¨ useMemo æ¥ç¼“å­˜èŠ‚æµåçš„å‡½æ•°ã€‚èŠ‚æµåçš„å‡½æ•°å†…éƒ¨ä¼šè°ƒç”¨ fnRef å¯¹è±¡çš„å€¼ï¼Œå¹¶è¿”å›å‡½æ•°çš„æ‰§è¡Œç»“æœã€‚
  const throttled = useMemo(
    () =>
      // ä½¿ç”¨ lodash çš„ throttle å‡½æ•°å®ç°èŠ‚æµå‡½æ•°ï¼Œå‚æ•°é…ç½®ä¹Ÿå®Œå…¨ä¸ lodash çš„ throttle å‡½æ•°ä¸€è‡´ã€‚
      throttle(
        (...args: Parameters<T>): ReturnType<T> => {
          return fnRef.current(...args);
        },
        wait,
        options,
      ),
    [],
  );

  // 4. ç„¶åï¼Œä½¿ç”¨ useUnmount æ¥å¸è½½èŠ‚æµåçš„å‡½æ•°ã€‚
  useUnmount(() => {
    throttled.cancel();
  });

  // 5. æœ€åï¼Œè¿”å›èŠ‚æµåçš„å‡½æ•°ï¼ŒåŒ…æ‹¬ runã€cancelã€flush ä¸‰ä¸ªæ–¹æ³•ã€‚
  return {
    run: throttled,
    cancel: throttled.cancel,
    flush: throttled.flush,
  };
}
```
